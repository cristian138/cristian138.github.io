<?php
// calculadora_creditos.php

$resultados   = [];
$mensajeError = '';

// 1. Procesamiento tras envío del formulario
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // 1.1. Lectura en crudo de las entradas
    $rawBasico      = filter_input(INPUT_POST, 'valor_basico',      FILTER_UNSAFE_RAW);
    $rawDisciplinar = filter_input(INPUT_POST, 'valor_disciplinar', FILTER_UNSAFE_RAW);
    $rawPagado      = filter_input(INPUT_POST, 'total_pagado',      FILTER_UNSAFE_RAW);
    $rawCreditos    = filter_input(INPUT_POST, 'total_creditos',    FILTER_UNSAFE_RAW);

    // 1.2. Eliminación de puntos de miles
    $valorBasico      = str_replace('.', '', $rawBasico);
    $valorDisciplinar = str_replace('.', '', $rawDisciplinar);
    $totalPagado      = str_replace('.', '', $rawPagado);
    $totalCreditos    = str_replace('.', '', $rawCreditos);

    // 1.3. Validación de dígitos enteros
    if (!ctype_digit($valorBasico) || !ctype_digit($valorDisciplinar)
        || !ctype_digit($totalPagado) || !ctype_digit($totalCreditos)) {
        $mensajeError = "Por favor ingrese valores numéricos enteros válidos en todos los campos.";
    } else {
        // 1.4. Conversión a entero
        $valorBasico      = intval($valorBasico);
        $valorDisciplinar = intval($valorDisciplinar);
        $totalPagado      = intval($totalPagado);
        $totalCreditos    = intval($totalCreditos);

        // 1.5. Cálculo de combinaciones válidas
        $maxBasicos = intdiv($totalPagado, $valorBasico);
        for ($b = 0; $b <= $maxBasicos; $b++) {
            $d = $totalCreditos - $b;
            if ($d < 0) {
                continue;
            }
            if ($b * $valorBasico + $d * $valorDisciplinar === $totalPagado) {
                $resultados[] = ['b' => $b, 'd' => $d];
            }
        }

        if (empty($resultados)) {
            $mensajeError = "No se encontró ninguna combinación válida con los datos proporcionados.";
        }
    }
}
?>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Créditos Académicos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    form { max-width: 400px; }
    label { display: block; margin-top: 1em; }
    input[type="text"],
    input[type="number"] { width: 100%; padding: 0.5em; }
    button { margin-top: 1em; padding: 0.5em 1em; }
    .error { color: #a00; margin-top: 1em; }
    .resultado { margin-top: 1em; background: #eef; padding: 1em; }
  </style>
</head>
<body>
  <h1>Calculadora de Créditos Académicos</h1>

  <!-- Mensaje de error -->
  <?php if ($mensajeError): ?>
    <div class="error"><?= htmlspecialchars($mensajeError) ?></div>
  <?php endif; ?>

  <!-- Formulario de entrada -->
  <form method="post" action="">
    <label>
      Valor por crédito básico:
      <input
        type="text"
        id="valor_basico"
        name="valor_basico"
        required
        value="<?= htmlspecialchars($rawBasico ?? '') ?>">
    </label>

    <label>
      Valor por crédito disciplinar:
      <input
        type="text"
        id="valor_disciplinar"
        name="valor_disciplinar"
        required
        value="<?= htmlspecialchars($rawDisciplinar ?? '') ?>">
    </label>

    <label>
      Total pagado:
      <input
        type="text"
        id="total_pagado"
        name="total_pagado"
        required
        value="<?= htmlspecialchars($rawPagado ?? '') ?>">
    </label>

    <label>
      Total de créditos matriculados:
      <input
        type="number"
        id="total_creditos"
        name="total_creditos"
        required
        value="<?= htmlspecialchars($rawCreditos ?? '') ?>">
    </label>

    <button type="submit">Calcular</button>
    <button onclick="Limpiar()">Limpiar</button>
  </form>

  <!-- Resultados -->
  <?php if (!empty($resultados)): ?>
    <div class="resultado">
      <h2>Combinaciones válidas:</h2>
      <ul>
      <?php foreach ($resultados as $sol): ?>
        <li>
          Básicos: <strong><?= $sol['b'] ?></strong>,
          Disciplinares: <strong><?= $sol['d'] ?></strong>
        </li>
      <?php endforeach; ?>
      </ul>
    </div>
  <?php endif; ?>

  <!-- JavaScript: formateo automático con Intl.NumberFormat -->
  <script>
    const nf = new Intl.NumberFormat('es-CO');  // API de internacionalización de JavaScript :contentReference[oaicite:3]{index=3}
    function formatInput(evt) {
      let val = evt.target.value.replace(/\./g, '');
      if (!val) return evt.target.value = '';
      const num = parseInt(val, 10);
      if (isNaN(num)) return evt.target.value = '';
      evt.target.value = nf.format(num);
    }
    document.getElementById('valor_basico').addEventListener('input', formatInput);
    document.getElementById('valor_disciplinar').addEventListener('input', formatInput);
    document.getElementById('total_pagado').addEventListener('input', formatInput);
    
    function Limpiar() {
        document.getElementById('valor_basico').value = "";
        document.getElementById('valor_disciplinar').value = "";
        document.getElementById('total_pagado').value = "";
        document.getElementById('total_pagado').value = "";
        document.getElementById('total_creditos').value = "";
        
    }
  </script>
</body>
</html>
